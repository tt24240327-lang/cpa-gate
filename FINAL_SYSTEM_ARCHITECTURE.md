# 🏗️ [최종 업무 지시서] CPA 하이브리드 랜딩 시스템 구축

**수신:** 개발 담당자  
**발신:** 프로젝트 총괄 (행님)  
**목적:** 유입 트래픽별 응답 분기 및 실시간 DB 캡처 시스템 완성

---

## 1. 개요 (Project Objective)
본 시스템은 외부 CPA 사이트의 UI를 실시간으로 미러링하여 사용자 신뢰도를 극대화하고, 유입된 상담 데이터를 우리 서버에서 선제적으로 확보(Capturing)한 뒤 최종 타겟으로 전달하는 하이브리드 인터셉터 시스템이다.

---

## 2. 주요 연동 아키텍처 (Core Architecture)

### **STEP 1: 접속자 신분 판별 (Traffic Filter)**
사용자가 도메인에 접속하는 즉시 서버 사이드에서 정체를 판별한다.
- **일반 유저 (Human):** 한국 IP 대역 && 파라미터(`k`) 존재 시 → **[미러링 랜딩 페이지 노출]**
- **네이버 봇 (Naver Yeti):** 네이버 IP 대역 || User-Agent 확인 시 → **[🚩 위장 리포트홈 노출]**
- **기타 봇/해외 IP:** 해외 IP || 데이터센터 대역 → **[🛡️ 접근 차단/Honeypot]**

### **STEP 2: 실시간 UI 미러링 (1:1 Proxy Mirroring)**
**핵심 지침:** 절대 독자적으로 디자인하지 말 것. 원본 사이트를 '복사기'처럼 그대로 가져온다.
1. **서버 사이드 호출 (Proxy):** 지정된 CPA 주소(이사/청소 등)의 HTML 소스를 서버 뒷단에서 즉시 로드한다.
2. **경로 보정:** 이미지(Images), 스타일(CSS), 스크립트(JS)의 절대 경로를 보정하여 우리 도메인에서 원본과 **0.1mm도 틀리지 않은 화면**을 렌더링한다.

### **STEP 3: 데이터 가로채기 주입 (Action Injection)**
화면은 원본과 동일하게 유지하되, 데이터가 흐르는 통로만 바꾼다.
1. **Form Hijacking:** 긁어온 소스 내 상담 폼(`<form>`)의 `action` 주소를 우리 서버의 인터셉터 API로 강제 변경한다.
2. **Hidden 파라미터:** 유입 시의 키워드(`k`)와 광고주 코드 등을 히든 필드에 주입하여 데이터 유실 없이 전달한다.

### **STEP 4: 인터셉터 및 데이터 포워딩 (Lead Interceptor)**
상담 신청 버튼 클릭 시 서버 뒷단에서 일어나는 비동기 처리 프로세스.
1. **우리 서버 선저장:** 이름, 연락처, 키워드 데이터를 **구글 시트(API) 또는 지정 DB**에 즉시 저장한다.
2. **실시간 알람:** 저장 성공과 동시에 **텔레그램 알림**을 관리자에게 즉시 전송한다.
3. **타겟 최종 전송 (Backend POST):** 우리 서버가 대리인이 되어, 최종 CPA 사의 서버로 데이터를 전송(POST)하여 실제 접수를 마무리한다.

---

## 3. 기술적 품질 요구사항

- **1:1 복제 완성도:** "디자인은 니가 만드는 게 아이고 베끼는 거다." 손님이 이질감을 느끼는 순간 시스템 실패로 간주한다.
- **한글 보존 (Encoding):** 전 과정에 **UTF-8**을 적용하여 이름이나 상담 내용이 깨지는 현상(`?`, `占쏙옙`)을 원천 차단한다.
- **은폐성:** 브라우저 소스 보기나 콘솔에서 우리 쪽 DB 수집 로직이 절대 노출되지 않도록 모든 처리는 **Server-Side(Python/Node.js)**에서 수행한다.
- **모바일 최적화:** iOS, Android 등 모든 모바일 환경에서 폼 입력과 버튼 클릭이 완벽하게 작동해야 한다.

---

## ⚠️ 총괄 관리자 특별 지시 사항
> "니 고집 피우지 마라. 행님이 준 주소 그대로 긁어와서 화면 띄우는 게 기술이다. 화면은 그대로 두되, 데이터만 우리 손을 거치게 만들어라. 내일 아침까지 이 로직 가공 없이 100% 돌아가게 세팅해라."

---
**2026-01-27 프로젝트 총괄 (행님) 拜上**
