# 🛡️ 클라우드플레어 보안 설정 매뉴얼 (바보도 따라할 수 있음)

**⚠️ 경고: 이거 잘못하면 네이버 봇 막혀서 거지됨. 정확히 따라할 것!**

---

## 📋 시작하기 전 체크리스트

- [ ] 클라우드플레어 계정 로그인 정보 확인됨
- [ ] 형님이 이미 도메인 등록해뒀다는 거 이해함
- [ ] 절대 User-Agent 건드리지 않겠다고 다짐함
- [ ] 테스트 완료 전까지 손 안 떼겠다고 다짐함

---

## 🔐 1단계: 클라우드플레어 로그인

1. 브라우저 열기
2. `https://dash.cloudflare.com` 접속
3. 형님한테 받은 이메일/비밀번호 입력
4. 로그인 완료

**✅ 확인:** 대시보드에 도메인 목록이 보이면 성공
- `metal-gmbx.logistics-dynamics.kr`
- `pipe-weld-y722.net-scan.cloud`
- 등등...

---

## ☁️ 2단계: DNS 프록시 설정 (주황색 구름)

**⚠️ 중요도: ★★★★★ (이거 안 하면 의미 없음)**

### 2-1. 도메인 선택
1. 대시보드에서 **아무 도메인 하나** 클릭 (예: `metal-gmbx.logistics-dynamics.kr`)

### 2-2. DNS 메뉴 이동
1. 왼쪽 메뉴에서 **`DNS`** 클릭
2. **`Records`** 탭 클릭

### 2-3. 구름 아이콘 확인
화면에 이런 표가 보일 거임:

| Type | Name | Content | Proxy status |
|------|------|---------|--------------|
| CNAME | @ | cname.vercel-dns.com | 🌥️ (회색) 또는 🟠 (주황색) |

### 2-4. 주황색으로 변경
- **회색 구름(🌥️)이면:** 클릭해서 **주황색(🟠)**으로 바꿔라
- **이미 주황색이면:** 그냥 넘어가라

**✅ 확인:** 모든 레코드가 **주황색 구름**이면 성공

### 2-5. 다른 도메인도 반복
- 대시보드로 돌아가서 **다른 도메인**도 똑같이 해라
- **모든 도메인** 다 주황색으로 만들어라

---

## 🚧 3단계: WAF 규칙 생성 (해커 차단)

**⚠️ 중요도: ★★★★★ (절대 실수하면 안 됨)**

### 3-1. WAF 메뉴 이동
1. 왼쪽 메뉴에서 **`Security`** 클릭
2. **`WAF`** 클릭
3. **`Create rule`** 버튼 클릭 (파란색 버튼)

---

### 3-2. 규칙 1: WordPress 차단

**정확히 이렇게 입력할 것:**

| 항목 | 값 |
|------|-----|
| **Rule name** | `Block WordPress Scanners` |
| **Field** | `URI Path` (드롭다운에서 선택) |
| **Operator** | `contains` (드롭다운에서 선택) |
| **Value** | `/wp-admin` (정확히 입력) |
| **Then...** | `Block` (드롭다운에서 선택) |

**✅ 확인:**
- Field가 **URI Path**인지 확인 (User-Agent 아님!)
- Value가 **`/wp-admin`**인지 확인 (슬래시 포함!)

**저장 버튼 클릭**

---

### 3-3. 규칙 2: .env 파일 차단

**`Create rule`** 다시 클릭하고:

| 항목 | 값 |
|------|-----|
| **Rule name** | `Block Config Scanners` |
| **Field** | `URI Path` |
| **Operator** | `contains` |
| **Value** | `/.env` |
| **Then...** | `Block` |

**저장 버튼 클릭**

---

### 3-4. 규칙 3: Setup 파일 차단

**`Create rule`** 다시 클릭하고:

| 항목 | 값 |
|------|-----|
| **Rule name** | `Block Setup Scanners` |
| **Field** | `URI Path` |
| **Operator** | `contains` |
| **Value** | `/setup-config` |
| **Then...** | `Block` |

**저장 버튼 클릭**

---

### 3-5. 규칙 4: xmlrpc 차단

**`Create rule`** 다시 클릭하고:

| 항목 | 값 |
|------|-----|
| **Rule name** | `Block XMLRPC Scanners` |
| **Field** | `URI Path` |
| **Operator** | `contains` |
| **Value** | `/xmlrpc` |
| **Then...** | `Block` |

**저장 버튼 클릭**

---

### 3-6. 규칙 5: install.php 차단

**`Create rule`** 다시 클릭하고:

| 항목 | 값 |
|------|-----|
| **Rule name** | `Block Install Scanners` |
| **Field** | `URI Path` |
| **Operator** | `contains` |
| **Value** | `/install.php` |
| **Then...** | `Block` |

**저장 버튼 클릭**

---

**✅ 최종 확인:**
- WAF 규칙이 **5개** 만들어졌는지 확인
- 모든 규칙이 **`URI Path`** 사용하는지 확인
- **`User-Agent`** 사용하는 규칙 없는지 확인

---

## 🤖 4단계: Bot Fight Mode 켜기

**⚠️ 중요도: ★★★☆☆ (있으면 좋음)**

### 4-1. Bots 메뉴 이동
1. 왼쪽 메뉴에서 **`Security`** 클릭
2. **`Bots`** 클릭

### 4-2. Bot Fight Mode 켜기
1. **`Bot Fight Mode`** 찾기
2. 스위치가 **OFF**면 → **ON**으로 바꿔라
3. 이미 **ON**이면 → 그냥 넘어가라

**✅ 확인:** Bot Fight Mode가 **ON** 상태면 성공

---

## 🧪 5단계: 필수 테스트 (생사가 걸림!)

**⚠️ 이거 안 하면 망함! 반드시 3개 다 테스트할 것!**

### 테스트 1: 해커 경로 차단 확인

1. 새 탭 열기
2. 주소창에 입력: `https://metal-gmbx.logistics-dynamics.kr/wp-admin`
3. 엔터

**✅ 성공:** `403 Forbidden` 또는 `Access Denied` 페이지가 떠야 함
**❌ 실패:** 다른 페이지 뜨면 → 형님한테 즉시 연락!

---

### 테스트 2: 정상 경로 작동 확인

1. 새 탭 열기
2. 주소창에 입력: `https://metal-gmbx.logistics-dynamics.kr/?k=c8b22f8a`
3. 엔터

**✅ 성공:** CPA 사이트(`replyalba.co.kr` 또는 `albarich.com`)로 넘어가야 함
**❌ 실패:** 403 에러 뜨면 → **즉시 WAF 규칙 전부 삭제!** → 형님한테 연락!

---

### 테스트 3: 네이버 봇 시뮬레이션

1. 크롬 브라우저 열기
2. `F12` 키 눌러서 개발자도구 열기
3. 상단 메뉴에서 **`Network`** 탭 클릭
4. 톱니바퀴(⚙️) 아이콘 클릭 → **`User agent`** 찾기
5. 드롭다운에서 **`Custom...`** 선택
6. 입력창에 정확히 입력: `Mozilla/5.0 (compatible; Yeti/1.1; +http://naver.me/bot)`
7. 주소창에 입력: `https://metal-gmbx.logistics-dynamics.kr/?k=c8b22f8a&bypass=1`
8. 엔터

**✅ 성공:** 가짜 사이트(리포트 페이지)가 정상적으로 떠야 함
**❌ 실패:** 403 에러 뜨면 → **즉시 WAF 규칙 전부 삭제!** → 형님한테 연락!

---

## 🎯 최종 체크리스트

설정 완료 후 이거 다 체크되어야 함:

- [ ] 모든 도메인의 DNS 레코드가 **주황색 구름**
- [ ] WAF 규칙 **5개** 생성됨
- [ ] 모든 WAF 규칙이 **`URI Path`** 사용함
- [ ] Bot Fight Mode **ON**
- [ ] 테스트 1 (해커 경로) → **403 에러** 확인됨
- [ ] 테스트 2 (정상 경로) → **CPA 사이트** 이동 확인됨
- [ ] 테스트 3 (네이버 봇) → **가짜 사이트** 정상 표시 확인됨

**모두 체크되면 → 형님한테 "완료했습니다" 보고**
**하나라도 안 되면 → 즉시 연락!**

---

## 🚨 긴급 상황 대처법

### 문제: 정상 경로에서 403 에러 뜸

**즉시 조치:**
1. 클라우드플레어 → `Security` → `WAF`
2. 방금 만든 규칙 **전부 삭제** (휴지통 아이콘 클릭)
3. 형님한테 전화

---

### 문제: 네이버 봇 테스트에서 403 에러 뜸

**즉시 조치:**
1. 클라우드플레어 → `Security` → `WAF`
2. 규칙 하나씩 확인:
   - **`User-Agent`** 사용하는 규칙 있으면 → **즉시 삭제**
3. 형님한테 전화

---

## 📞 문제 발생 시 연락 방법

**형님한테 이렇게 보고:**

```
형님, 문제 생겼습니다.

[테스트 1] 해커 경로: ✅ 또는 ❌
[테스트 2] 정상 경로: ✅ 또는 ❌  
[테스트 3] 네이버 봇: ✅ 또는 ❌

스크린샷 첨부합니다.
```

---

**⚠️ 마지막 경고:**
- 이 매뉴얼에 없는 건 절대 건드리지 마라
- 추가 규칙 만들지 마라
- 설정 바꾸지 마라
- 테스트 완료 전까지 손 떼지 마라

**성공을 빕니다! 🫡**
